(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{406:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#目录"}},[s._v("#")]),s._v(" 目录")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#%E6%A6%82%E8%BF%B0"}},[s._v("概述")])]),s._v(" "),t("li",[t("a",{attrs:{href:"#%E6%93%8D%E4%BD%9C%E7%A4%BA%E4%BE%8B"}},[s._v("操作示例")])]),s._v(" "),t("li",[t("a",{attrs:{href:"#%E6%80%BB%E7%BB%93"}},[s._v("总结")])])]),s._v(" "),t("h2",{attrs:{id:"概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),t("p",[s._v("在机器学习的实际应用场景中常见的做法是，在把机器学习模型封装为API路由提供预测服务之前，先进行离线训练。具体来说，我们希望有一个API路由可以对单一行/实例/样本/数据点/事件（随你怎么叫）进行预测。市面上我们有很好的工具来做这件事，这些工具可以帮助处理到琐碎的细节，比如"),t("a",{attrs:{href:"https://github.com/cortexlabs/cortex",target:"_blank",rel:"noopener noreferrer"}},[s._v("Cortex"),t("OutboundLink")],1),s._v("、"),t("a",{attrs:{href:"https://www.mlflow.org/docs/latest/models.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("MLFlow"),t("OutboundLink")],1),s._v("、"),t("a",{attrs:{href:"https://www.kubeflow.org/docs/components/serving/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Kubeflow"),t("OutboundLink")],1),s._v("和"),t("a",{attrs:{href:"https://github.com/ucbrise/clipper",target:"_blank",rel:"noopener noreferrer"}},[s._v("Clipper"),t("OutboundLink")],1),s._v("。还有一些商业版的服务，如"),t("a",{attrs:{href:"https://www.datarobot.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("DataRobot"),t("OutboundLink")],1),s._v("、"),t("a",{attrs:{href:"https://www.h2o.ai/",target:"_blank",rel:"noopener noreferrer"}},[s._v("H2O"),t("OutboundLink")],1),s._v("和"),t("a",{attrs:{href:"https://www.cubonacci.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Cubonacci"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("p",[s._v("这些解决方案通常假定你将使用数据科学生态系统中的一个流行库，如scikit-learn、Keras、PyTorch、XGBoost或LightGBM。需要注意的是，这些库中的大多数从来都不是为了进行预测而设计的。事实上，它们中的很大一部分是在把机器学习模型放在API端点后面变得很酷（真正的生产）之前开始的。也就是说，这些库的设计是为了进行批量预测。它们处理1000个样本的速度比处理1个样本1000次的速度快。这主要是因为它们依赖于"),t("a",{attrs:{href:"https://www.wikiwand.com/en/SIMD",target:"_blank",rel:"noopener noreferrer"}},[s._v("SIMD"),t("OutboundLink")],1),s._v("操作和线性代数技巧，在大量数据的情况下可以很好地扩展。因此，这些库不是进行个体预测的最佳选择。然而，可以在这些库的基础上使用小技巧降低预测的延迟。")]),s._v(" "),t("p",[s._v("本文将重点讨论scikit-learn的一些优化技巧。首先，如果你打算在生产中使用或已经在使用scikit-learn，那么"),t("a",{attrs:{href:"https://scikit-learn.org/stable/modules/computing.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Computing with scikit-learn"),t("OutboundLink")],1),s._v("文档是必读的。它包括了很多让计算变得更快的技巧和窍门。我将专注于预测速度，在机器学习的生产场景下，我们通常称之为为“延迟”。")]),s._v(" "),t("h2",{attrs:{id:"操作示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#操作示例"}},[s._v("#")]),s._v(" 操作示例")]),s._v(" "),t("p",[s._v("首先，让我们先测算scikit-learn的"),t("code",[s._v("LinearRegression")]),s._v("在单行上的预测速度。我将使用IPython的"),t("code",[s._v("%timeit")]),s._v("命令来得到一个可靠的估计。我还将使用scikit-learn的最新版本，到目前为止是"),t("code",[s._v("1.1.2")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" sklearn "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" datasets\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" sklearn "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" linear_model\n\nX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" y "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" datasets"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("load_boston"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("return_X_y"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlin_reg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" linear_model"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("LinearRegression"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlin_reg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" y"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("timeit lin_reg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("predict"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" µs ± "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("119")]),s._v(" ns per loop "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean ± std. dev. of "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" runs, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100,000")]),s._v(" loops each"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("16微秒的时间看起来并不多，但事实证明，我们可以做得更好。问题是，每次你调用"),t("code",[s._v("predict")]),s._v("时，scikit-learn都会进行大量的检查。例如，它检查你是否提供了一个二维的numpy数组，特征的数量是否正确，是否有任何值丢失，等等。在许多情况下，这些检查可能是多余的，因为你可能已经在你的应用程序中作为验证步骤的一部分自己做了这些检查。因此，我们可以写一个“裸化”的实现，跳过这些细节，直奔本质，也就是评估线性回归。从本质上讲，线性回归只是一个截距和一些权重与输入特征之间的点乘之和。我们可以自己实现这一点。为此，我们将定义一个带有"),t("code",[s._v("predict_single")]),s._v("方法的"),t("code",[s._v("BarebonesLinearRegression")]),s._v("类，该方法接收一个一维数组作为输入。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" numpy "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" np\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BarebonesLinearRegression")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("linear_model"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("LinearRegression"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("predict_single")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" np"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("coef_"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("intercept_\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("让我们看看自己实现的方法会有多大提升：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("bb_lin_reg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" BarebonesLinearRegression"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nbb_lin_reg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" y"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("timeit bb_lin_reg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("predict_single"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("590")]),s._v(" ns ± "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30.9")]),s._v(" ns per loop "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean ± std. dev. of "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" runs, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1,000")]),s._v(",000 loops each"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("“裸化”的实现平均比scikit-learn的实现快27倍。这个倍数在使用复杂度更高的模型时会显得更加明显。此外，除了考虑模型的预测时间还要考虑特征工程和来自HTTP协议的API的时间延迟，综合来看的话，模型部分的预测优化也更加有必要。")]),s._v(" "),t("p",[s._v("我们可以将这个技巧应用于其他模型，比如scikit-learn的"),t("code",[s._v("LogisticRegression")]),s._v("。让我们首先评估一下默认的实现。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" sklearn "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" datasets\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" sklearn "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" preprocessing\n\nX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" y "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" datasets"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("load_digits"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("return_X_y"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nX "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" preprocessing"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("scale"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlog_reg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" linear_model"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("LogisticRegression"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlog_reg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" y"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("timeit log_reg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("predict_proba"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26.5")]),s._v(" µs ± "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.28")]),s._v(" µs per loop "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean ± std. dev. of "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" runs, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10,000")]),s._v(" loops each"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("我们可以用scipy的softmax函数实现"),t("code",[s._v("predict_single")]),s._v("方法：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" scipy "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" special\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BarebonesLogisticRegression")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("linear_model"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("LogisticRegression"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("predict_proba_single")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" special"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("softmax"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("np"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("coef_"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("intercept_"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("让我们看看我们是否有什么收获：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("bb_log_reg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" BarebonesLogisticRegression"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nbb_log_reg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" y"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("timeit bb_log_reg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("predict_proba_single"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.9")]),s._v(" µs ± "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("57.2")]),s._v(" ns per loop "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean ± std. dev. of "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" runs, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100,000")]),s._v(" loops each"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这是一个肉眼可见的进步，但还可以继续优化。首先，我们可以用IPython的"),t("code",[s._v("%prun")]),s._v("命令来检查什么东西花的时间最多：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("prun "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("l "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("bb_log_reg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("predict_proba_single"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" _ "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("range")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v(" \n         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4200004")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" calls "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.761")]),s._v(" seconds\n\n   Ordered by: internal "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("\n   List reduced from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(" to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" due to restriction "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v("\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("function"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.453")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.434")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v(" _logsumexp.py:7"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("logsumexp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.195")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.195")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("method "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'reduce'")]),s._v(" of "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'numpy.ufunc'")]),s._v(" objects"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.139")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.556")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("built-in method numpy.core._multiarray_umath.implement_array_function"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.124")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.258")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v(" _ufunc_config.py:32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("seterr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.099")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.533")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v(" _logsumexp.py:130"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("softmax"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.090")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.125")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v(" _util.py:247"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_asarray_validated"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.088")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.334")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v(" fromnumeric.py:69"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_wrapreduction"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.088")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.097")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v(" _ufunc_config.py:131"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("geterr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.068")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.729")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3744590719")]),s._v(".py:5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("predict_proba_single"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.042")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.191")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v(" fromnumeric.py:2123"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sum"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("从数据中可以看出时间花在了哪里：是被special.softmax调用的logsumexp函数。special.softmax的实现方式避免了潜在的数字下溢和溢出，如这里所解释的。然而，它似乎比自定义的实现方式要慢，而后者仍然稳定。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("custom_softmax")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    z "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("max")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    numerator "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" np"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("z"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    denominator "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" np"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("sum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("numerator"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" numerator "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" denominator\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BarebonesLogisticRegression")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("linear_model"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("LogisticRegression"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("predict_proba_single")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" custom_softmax"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("np"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("coef_"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("intercept_"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("优化后的表现为：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("bb_log_reg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" BarebonesLogisticRegression"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nbb_log_reg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" y"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("timeit bb_log_reg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("predict_proba_single"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.06")]),s._v(" µs ± "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.4")]),s._v(" ns per loop "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean ± std. dev. of "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" runs, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100,000")]),s._v(" loops each"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这比使用special.softmax快2.35倍，比scikit-learn的默认实现快5.24倍。还凑合!")]),s._v(" "),t("p",[s._v("线性回归和逻辑回归可能是简单的方法，但是根据微软团队最近的一份调查报告，它们是scikit-learn中使用最多的两个类，所以它们值得关注。那么对于scikit-learn的"),t("code",[s._v("StandardScaler")]),s._v("呢？它是任何线性模型之前的一个常见的特征预处理步骤，因此很可能会与上述两个模型一起使用。像前文一样，让我们从测量默认实现的性能开始。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" sklearn "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" preprocessing\n\nscaler "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" preprocessing"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("StandardScaler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nscaler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("timeit scaler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("transform"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.9")]),s._v(" µs ± "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("368")]),s._v(" ns per loop "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean ± std. dev. of "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" runs, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100,000")]),s._v(" loops each"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("一个标准的缩放步骤只需要减去数据的列平均值并除以列标准差，就像这样：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BarebonesStandardScaler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("preprocessing"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("StandardScaler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("transform_single")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mean_"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("var_ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".5")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("这给我们带来了如下的表现：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.23")]),s._v(" µs ± "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.7")]),s._v(" ns per loop "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean ± std. dev. of "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" runs, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1,000")]),s._v(",000 loops each"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("现在，如果我们想把我们自定义的"),t("code",[s._v("BarebonesStandardScaler")]),s._v("与"),t("code",[s._v("BarebonesLinearRegression")]),s._v("或"),t("code",[s._v("BarebonesLogisticRegression")]),s._v("同时使用呢？在scikit-learn中，组成建模步骤的典型方法是通过使用管道。我们可以实现一个自定义的管道类，它继承自scikit-learn的"),t("code",[s._v("pipeline.Pipeline")]),s._v("，并提供一个"),t("code",[s._v("predict_single")]),s._v("函数和一个"),t("code",[s._v("predict_proba_single")]),s._v("函数。具体如下：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" sklearn "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" pipeline\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BarebonesPipeline")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pipeline"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Pipeline"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("predict_single")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" _"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" transformer "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("steps"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" transformer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("transform_single"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("steps"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("predict_single"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("predict_proba_single")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" _"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" transformer "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("steps"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" transformer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("transform_single"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("steps"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("predict_proba_single"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("让我们看看我们获得的执行速度如何：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("bb_pp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" BarebonesPipeline"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bb_scaler'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" bb_scaler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bb_lin_reg'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" bb_lin_reg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nbb_pp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" y"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("timeit bb_pp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("predict_single"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.98")]),s._v(" µs ± "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" ns per loop "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean ± std. dev. of "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" runs, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100,000")]),s._v(" loops each"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("现在让我们把它与scikit-learn的默认实现进行比较：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("pp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pipeline"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Pipeline"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'scaler'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" scaler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'lin_reg'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" lin_reg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" y"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("timeit pp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("predict"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("34.3")]),s._v(" µs ± "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.81")]),s._v(" µs per loop "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mean ± std. dev. of "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" runs, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10,000")]),s._v(" loops each"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("我们的自定义实现大约快17.3倍。最后，我们可以检查我们的实现是否产生了正确的输出。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" xi "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("assert")]),s._v(" pp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("predict"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("xi"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" bb_pp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("predict_single"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("xi"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),t("p",[s._v("我们的收获是，你可以用scikit-learn加快预测的速度，但这需要了解算法的实际工作原理和实现方式，这未必是一件坏事。")])])}),[],!1,null,null,null);t.default=e.exports}}]);