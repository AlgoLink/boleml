(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{403:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#目录"}},[t._v("#")]),t._v(" 目录")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E8%80%81%E5%BC%8F%E6%8B%9F%E5%90%88/%E9%A2%84%E6%B5%8B%E8%8C%83%E5%BC%8F"}},[t._v("老式拟合/预测范式")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E6%98%AF%E6%97%B6%E5%80%99%E6%8D%A2%E4%B8%AA%E8%8C%83%E5%BC%8F%E4%BA%86"}},[t._v("是时候换个范式了")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E6%9C%89%E7%8A%B6%E6%80%81%E7%9A%84%E5%9C%A8%E7%BA%BF%E5%AD%A6%E4%B9%A0"}},[t._v("有状态的在线学习")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E6%97%A0%E7%9B%91%E7%9D%A3%E7%9A%84%E6%A8%A1%E5%9E%8B%E5%91%A2"}},[t._v("无监督的模型呢？")])])]),t._v(" "),s("p",[t._v("一个事实是：设计机器学习软件是困难的。试图不做任何妥协的设计决定是很难的。因为，用模型管道进行预测是一个有状态的操作，而用户希望它是纯粹的、易用的以及没有副作用的。这也是设计"),s("code",[t._v("banditrl")]),t._v("的初衷：简洁、有效、易用、灵活可生产。")]),t._v(" "),s("h2",{attrs:{id:"老式拟合-预测范式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#老式拟合-预测范式"}},[t._v("#")]),t._v(" 老式拟合/预测范式")]),t._v(" "),s("p",[t._v("当前业界最流行的机器学习库"),s("code",[t._v("scikit-learn")]),t._v("的设计中非常优秀的一点是它对我们思考机器学习任务的方式产生了深刻的影响。几乎所有的监督学习任务都涉及到训练一个模型--"),s("code",[t._v("拟合(fit)")]),t._v("--并将其应用于未标记的数据--"),s("code",[t._v("预测(predict)")]),t._v("。"),s("code",[t._v("scikit-learn")]),t._v("的设计方式也是基于这两个功能展开的，我们可以看到在"),s("code",[t._v("scikit-learn package")]),t._v("中，几乎所有的功能包括学习和特征工程都会被抽象出"),s("code",[t._v("fit/predict")]),t._v("接口。")]),t._v(" "),s("p",[t._v("拟合/预测范式是无处不在的，因为它很直观。拟合一个模型是一个有状态的操作，它更新上述模型的每个组件。预测是一个纯粹的无状态操作，它只是通过每个组件运行输入并产生一个输出。Kaggle和其他竞赛平台已经将这种模式普遍化。")]),t._v(" "),s("p",[t._v("我发现有趣的是，生产系统中发生的情况完全相反。当一个新的样本到达时，系统首先产生一个预测。一旦相关的基础实时（比如用户反馈）显示出来，系统就会从样本中学习。这就是业界优先使用监督学习的全部意义：我们现在要预测一个未知的变量，且只有在事后才能接触到真相。")]),t._v(" "),s("p",[t._v("值得思考的是，在离线设置中，这种拟合/预测程序通常是在离线设置中完成的。在一个生产系统中，会有新的数据定期进来。最初对这些数据点进行预测。然后，这些数据可以被贴上标签（需要预测的label，与传统意义上的用户标签不同）。这就产生了新的训练数据，可以用来重新训练模型。如下图所示：")]),t._v(" "),s("div",{attrs:{align:"center"}},[s("img",{attrs:{src:"/fit_predict.png",width:"60%"}})]),t._v(" "),s("br"),t._v(" "),s("center",[t._v("说起来容易，做起来难")]),t._v(" "),s("p",[t._v("截至目前，要学术环境中的算法模型落实生产可用仍然是一个非常具有挑战性的过程，这一过程依赖大量的工程和运维人员和基础设施。从工业界的实际应用也可以看出，当前机器学习在实际业务中产生价值的也更多是一些大厂。也正因为这些限制，一些中小企和数字化转型的企业因短期内很难实现真正的“模型驱动”。值得庆幸的是，数据科学的生态系统正在朝着成熟的方向发展。然而，大多数解决方案迎合了批处理系统，在有数据时必须重新训练。我对不需要重新训练的在线系统更感兴趣。他们的生命周期是不同的。")]),t._v(" "),s("h2",{attrs:{id:"是时候换个范式了"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#是时候换个范式了"}},[t._v("#")]),t._v(" 是时候换个范式了")]),t._v(" "),s("p",[t._v("在线机器学习模型可以渐进式学习。它不需要访问以前的训练数据，就能从新的训练数据中学习。不过，在线学习系统的构建需要一个权衡。一方面，模型可以从新标记的数据中几乎即时更新。另一方面，它的性能必然不如在相同数据量上训练的批量模型。当你想在有新的训练数据时立即学习，而不是定期从头开始重新训练一个批处理模型时，在线机器学习方法是有意义的。")]),t._v(" "),s("p",[t._v("在一个在线环境中，你不会真正把数据分成训练和测试数据。每个观测值都会被模型看到两次。第一次是在特征"),s("code",[t._v("x")]),t._v("到达时进行预测。第二次是当反馈"),s("code",[t._v("Y")]),t._v("在稍后的时间点被记录时，模型被更新为一对"),s("code",[t._v("(x，y)")]),t._v("。这种交错的好处是，每个预测都可以与真实反馈进行比较，以获得一个"),s("code",[t._v("out-of-fold")]),t._v("的性能估计。这就是所谓的渐进式验证。换句话说，数据流既是训练集又是测试集。")]),t._v(" "),s("p",[t._v("乍一看，这似乎很简单，因为我们只是像往常的离线模型一样简单地扭转了拟合/预测过程，尽管是以在线方式。然而，魔鬼就在细节中。诀窍在于，一个模型可以由无监督的部分和有监督的部分组成。例如，以下面的"),s("code",[t._v("banditrl")]),t._v("模型为例，它是一个提取一些特征的管道，对其进行缩放，然后将其喂给逻辑回归。")]),t._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" bandirtl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("preprocessing "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" preprocessor\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" bandirtl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("preprocessing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("feature_encodings "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" BanditContextEncoder\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" bandirtl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("utils "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" model_constructors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("utils\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BanditPredictor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""Class used to make predictions given a trained bandit model including reward."""')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("__init__")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ml_config"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ml_config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ml_config\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("build_model\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model_type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ml_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"model_type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ml_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"model_id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reward_type "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ml_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"reward_type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"regression"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        log_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ml_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"storage"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"log_path"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        model_acc_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ml_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"storage"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"model_acc_path"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" log_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log_db "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" utils"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log_data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("log_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log_db "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" model_acc_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model_acc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hirlite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Rlite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("model_acc_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"model_acc.db"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("encoding"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf8'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model_acc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),t._v("\n        predictor_save_dir "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ml_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"storage"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"predictor_save_dir"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" predictor_save_dir "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("feature_transformer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("build_feature_transformer\n\n    "),s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@property")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build_feature_transformer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        predictor_save_dir "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ml_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"storage"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"predictor_save_dir"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" predictor_save_dir "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            logger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("info"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"loading predictor artifacts from disk..."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            model_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ml_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"model_id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"model"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            save_dir "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("predictor_save_dir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("model_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('/"')])]),t._v("\n            predictor_config_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("save_dir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("model_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('_features.pkl"')])]),t._v("\n            feature_transformer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BanditContextEncoder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encoder_from_file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("predictor_config_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" feature_transformer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("predict\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_action")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                   feature"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n                   request_id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                   model_id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                   topN"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                   uid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                   auto_feature"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                   user_model"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br")])]),s("p",[t._v("当一组新的特征"),s("code",[t._v("x")]),t._v("到来时，我们即时更新无监督的组件（比如在线实时特征，这部分更新也可以在feature store的组件中进行），可以实时拟合数据的分布，通过即时计算总体特征或用更精确的统计量进行缩放。事实上，不这样做将是一种浪费。为什么要等到"),s("code",[t._v("y")]),t._v("的出现？为什么不在预测阶段直接更新这些组件呢？一旦有了"),s("code",[t._v("y")]),t._v("，我们总是可以在以后更新有监督的部分。这不是一个传统的思路，它源于这样一个事实，即在线学习使预测在模型更新之前就已经可以进行了。教科书上很少会提及这种工程角度的细节和思路，它是在我花了很多时间研究在线学习之后才想到的。但我非常喜欢这个思路。它还能带来更好的性能，所以有理由相信它是正确的。")]),t._v(" "),s("p",[t._v("这个思路可以归结为在预测阶段从未标记的数据中学习。实际上，我们在训练批量模型时也做了类似的事情。这在Kaggle比赛中是很典型的。对于后者的离线批量训练模型，通常的做法是在提取特征和对数据进行整体预处理之前，圈定样本时需要将训练数据和测试数据串联起来。这种做法如果处理不当可能会导致数据泄漏（即“未来”的数据穿越到训练样本中）。")]),t._v(" "),s("p",[t._v("总之，这就是为什么"),s("code",[t._v("banditrl")]),t._v("的管道是有状态的。如果你单独使用任何"),s("code",[t._v("banditrl")]),t._v("估计器，它的"),s("code",[t._v("reward")]),t._v("方法是有状态的（即需要关联该用户的反馈对应的预测时的特征状态），而它的"),s("code",[t._v("get_action")]),t._v("--或"),s("code",[t._v("feature_transformer")]),t._v("--方法是无状态的。但是，需要注意的是，在管道中，对于无监督的部分，"),s("code",[t._v("get_action")]),t._v("方法是有状态的（需要接收特征工程后的特征组）。同时，管道中的"),s("code",[t._v("reward")]),t._v("方法只对有监督的组件是有状态的（除了要关联过去的特征还要关联当前的reward和label）。这意味着，当你用在线模型管道预测和训练时，一旦有必要的信息，每个组件就会被更新。")]),t._v(" "),s("h2",{attrs:{id:"有状态的在线学习"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#有状态的在线学习"}},[t._v("#")]),t._v(" 有状态的在线学习")]),t._v(" "),s("p",[t._v("这篇文章是一个很好的机会来讨论我喜欢的在线学习中所谓的“状态”，这部分有点像MLOps的模型注册和实验跟踪中的元数据管理，这些信息是整个生产流程完整可行的🔗纽带。在"),s("code",[t._v("banditrl")]),t._v("中，文档中的许多例子都是对数据集的简单循环。")]),t._v(" "),s("p",[t._v("预测和训练步骤可以完美地相互交错进行。每个步骤都接连着发生。需要注意的是，如果这个在线脚本的目标是模拟一个生产场景，那么这种完美的交错可能过于简化了。在现实中，在作出预测和揭示真相的时刻之间可能会有延迟。这种延迟可能因不同的观测而不同。例如，如果你要预测出租车出行的时间，那么延迟就会有所不同：它是出租车出行实际花费的时间。")]),t._v(" "),s("p",[t._v("如果你在生产中运行一个在线模型，那么你会希望存储用于进行预测的特征。然后你可以在反馈揭晓时抓住这些特征，并将它们配对在一起。这被非正式地称为“记录和等待”策略。这与反馈揭晓后从头开始生成特征是完全不同的。你真正希望使用的是在"),s("strong",[t._v("预测时")]),t._v("使用的特征，而不是事后。这样就可以避免数据泄露。你也可以为自己节省一些计算/网络的费用，自选存储设施。"),s("code",[t._v("banditrl")]),t._v("使用的"),s("code",[t._v("Rlite")]),t._v("（可以看作是redis的sqlite）。")]),t._v(" "),s("p",[t._v("这里所说的状态是指模型进行预测时可用的信息。拥有状态意味着你需要某种数据库来存储它，同时等待实际反馈的到来。在一些延迟时间很短的用例中，比如"),s("code",[t._v("CTR")]),t._v("预测，在不需要事后分析的情况下，你可能只需要把状态存储在内存中就可以了，因为你不需要等待很久。但在许多情况下，你需要一些适当的存储。更重要的是，存储这些信息使你有能力在事后重新运行模型。此外，如果你正确地存储数据--特征、真实标签以及它们各自的到达时间--那么你就可以进行低延迟的渐进式验证，即对你的模型进行准实时的评估。")]),t._v(" "),s("h2",{attrs:{id:"无监督的模型呢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#无监督的模型呢"}},[t._v("#")]),t._v(" 无监督的模型呢？")]),t._v(" "),s("p",[t._v("有些模型不需要标签来学习。例如，以异常检测为例。像任何其他估计器一样，异常检测器学习并进行预测。那么，它与任何其他无监督的估计器，如PCA或标准缩放，有什么不同？答案取决于模型是否应该在进行预测前从特征中学习。")]),t._v(" "),s("p",[t._v("一般来说，首先进行预测，然后再更新模型是有意义的。这对异常检测来说是可行的。异常检测器不需要标签来学习，因此是无监督的。然而，你可能首先要预测一个样本的异常分数，然后再从中学习。事实上，如果你认为样本是异常的，因为异常得分很高，那么你可能不想通过对样本的学习来破坏这个模型。")]),t._v(" "),s("p",[t._v("那么，聚类呢？让聚类模型在标记所述样本之前从样本中学习可能是有意义的。也许聚类模型是一个特例。"),s("code",[t._v("banditrl")]),t._v("的设计是，未来所有无监督的学习都是在预测/打分阶段更新的。我倾向于认为模型的更新应该发生在"),s("code",[t._v("get_action")]),t._v("阶段。让一切发生在"),s("code",[t._v("reward")]),t._v("阶段并不直观，尽管它仍然是正确的。这样做的代价是，一个输入必须经过管道的前"),s("code",[t._v("n-1")]),t._v("个步骤两次--一次在"),s("code",[t._v("reward")]),t._v("阶段，一次在"),s("code",[t._v("get_action")]),t._v("阶段。")])],1)}),[],!1,null,null,null);s.default=e.exports}}]);