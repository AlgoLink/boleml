<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>机器学习正在走向实时化 | boleml</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Everything you need to build AI .">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.0ab6a768.css" as="style"><link rel="preload" href="/assets/js/app.e0cdc796.js" as="script"><link rel="preload" href="/assets/js/3.c71f12a5.js" as="script"><link rel="preload" href="/assets/js/1.83d3f97c.js" as="script"><link rel="preload" href="/assets/js/13.726d257e.js" as="script"><link rel="prefetch" href="/assets/js/10.a8f43ca8.js"><link rel="prefetch" href="/assets/js/11.3ea36194.js"><link rel="prefetch" href="/assets/js/12.017c9c91.js"><link rel="prefetch" href="/assets/js/14.d52b7b3f.js"><link rel="prefetch" href="/assets/js/15.aa43a5a3.js"><link rel="prefetch" href="/assets/js/16.b80c6938.js"><link rel="prefetch" href="/assets/js/17.43f358a9.js"><link rel="prefetch" href="/assets/js/18.cc31abab.js"><link rel="prefetch" href="/assets/js/4.3480f6aa.js"><link rel="prefetch" href="/assets/js/5.9cd9f60e.js"><link rel="prefetch" href="/assets/js/6.94e1ceb2.js"><link rel="prefetch" href="/assets/js/7.731f8fef.js"><link rel="prefetch" href="/assets/js/8.169fbe89.js"><link rel="prefetch" href="/assets/js/9.2e260d39.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0ab6a768.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-5bb33761><div data-v-5bb33761><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-5bb33761 data-v-5bb33761><h3 class="title" data-v-59e6cb88>boleml</h3> <p class="description" data-v-59e6cb88>Everything you need to build AI .</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Leepand</span>
          
        <!---->
        2022
      </a></span></div></div> <div class="hide" data-v-5bb33761><header class="navbar" data-v-5bb33761><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="boleml" class="logo"> <span class="site-name">boleml</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/推荐系统/" class="nav-link"><i class="undefined"></i>
  推荐系统
</a></li><li class="dropdown-item"><!----> <a href="/categories/在线学习/" class="nav-link"><i class="undefined"></i>
  在线学习
</a></li><li class="dropdown-item"><!----> <a href="/categories/机器学习实践/" class="nav-link"><i class="undefined"></i>
  机器学习实践
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  更新动态
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/mlopskit/" class="nav-link"><i class="undefined"></i>
  mlopskit
</a></li><li class="dropdown-item"><!----> <a href="/docs/banditrl/" class="nav-link"><i class="undefined"></i>
  banditrl
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-5bb33761></div> <aside class="sidebar" data-v-5bb33761><div class="personal-info-wrapper" data-v-1fad0c41 data-v-5bb33761><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    Leepand
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>8</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>5</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/推荐系统/" class="nav-link"><i class="undefined"></i>
  推荐系统
</a></li><li class="dropdown-item"><!----> <a href="/categories/在线学习/" class="nav-link"><i class="undefined"></i>
  在线学习
</a></li><li class="dropdown-item"><!----> <a href="/categories/机器学习实践/" class="nav-link"><i class="undefined"></i>
  机器学习实践
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  更新动态
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/mlopskit/" class="nav-link"><i class="undefined"></i>
  mlopskit
</a></li><li class="dropdown-item"><!----> <a href="/docs/banditrl/" class="nav-link"><i class="undefined"></i>
  banditrl
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-5bb33761><h3 class="title" data-v-59e6cb88>机器学习正在走向实时化</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Leepand</span>
          
        <!---->
        2022
      </a></span></div></div> <div data-v-5bb33761><div data-v-5bb33761><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">机器学习正在走向实时化</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>Leepand</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>9/4/2022</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>machine learning</span><span class="tag-item" data-v-8a445198>online learning</span><span class="tag-item" data-v-8a445198>MLOps</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="目录"><a href="#目录" class="header-anchor">#</a> 目录</h1> <ul><li><a href="#%E6%A6%82%E8%BF%B0">概述</a></li> <li><a href="#level-1-%E5%9C%A8%E7%BA%BF%E9%A2%84%E6%B5%8B-%E4%BD%A0%E7%9A%84%E7%B3%BB%E7%BB%9F%E5%8F%AF%E4%BB%A5%E5%AE%9E%E6%97%B6%E8%BF%9B%E8%A1%8C%E9%A2%84%E6%B5%8B">level 1：在线预测——你的系统可以实时进行预测</a> <ul><li><a href="#%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B">应用案例</a></li> <li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">解决方案</a></li></ul></li> <li><a href="#level-2-%E6%8C%81%E7%BB%AD%E5%AD%A6%E4%B9%A0-%E4%BD%A0%E7%9A%84%E7%B3%BB%E7%BB%9F%E5%8F%AF%E4%BB%A5%E6%8E%A5%E6%94%B6%E6%96%B0%E6%95%B0%E6%8D%AE%E5%B9%B6%E5%AE%9E%E6%97%B6%E6%9B%B4%E6%96%B0">level 2：持续学习——你的系统可以接收新数据并实时更新</a> <ul><li><a href="#%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B">应用案例</a></li> <li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">解决方案</a></li> <li><a href="#%E6%8C%91%E6%88%98">挑战</a></li></ul></li> <li><a href="#%E6%80%BB%E7%BB%93">总结</a></li></ul> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p>我注意到当前业界在ML应用方面存在两组公司。一组已经对基础设施进行了大量投资（数亿元），以实现实时ML，并且已经看到了投资的回报；另一组公司仍然怀疑实时ML是否有价值。</p> <p>在前几年，对于实时ML的含义，似乎没有什么共识，而且业界也没有对它的做法进行深入讨论。在这篇文章中，我想分享我当前业界在实时ML方向的发展状况。</p> <p>实时ML是使用实时数据来产生更准确的预测，并使模型适应不断变化的环境的方法。实时ML有两个level，我将在这篇文章中进行介绍。</p> <ul><li>level 1：你的ML系统实时进行预测（在线预测）。</li> <li>level 2：你的系统可以纳入新的数据并实时更新你的模型（持续学习）。
我用“模型”来指机器学习模型，用“系统”来指它周围的基础设施，包括数据管道和监控系统。</li></ul> <h2 id="level-1-在线预测-你的系统可以实时进行预测"><a href="#level-1-在线预测-你的系统可以实时进行预测" class="header-anchor">#</a> level 1：在线预测——你的系统可以实时进行预测</h2> <p>这里的实时定义为在毫秒到秒的范围内。</p> <h3 id="应用案例"><a href="#应用案例" class="header-anchor">#</a> 应用案例</h3> <p>延迟很重要，特别是对于面向用户的应用程序。2009年，<a href="https://services.google.com/fh/files/blogs/google_delayexp.pdf" target="_blank" rel="noopener noreferrer">谷歌的实验表明，网络搜索延迟增加100至400毫秒，每个用户每天的搜索次数减少0.2%至0.6%<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。2019年，<a href="https://blog.acolyer.org/2019/10/07/150-successful-machine-learning-models/" target="_blank" rel="noopener noreferrer">Booking.com发现，延迟增加30%，就会损失约0.5%的转化率——“对我们的业务来说是一个延迟与成本是正相关的”<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>无论你的ML模型有多棒，如果它们在进行预测时需要几百毫秒甚至秒级的时间，用户就会点击其他东西。</p> <h4 id="批量预测的问题"><a href="#批量预测的问题" class="header-anchor">#</a> 批量预测的问题</h4> <p>在业界离线预测也是比较普遍的存在，即离线情况下批量生成预测结果，将其存储起来（例如在SQL表中），并在需要时拉出预先计算的预测结果。</p> <p>当输入空间是有限的时候，这就可以发挥作用--你需要确切地知道有多少可能的输入要进行预测。一个例子是当你需要为你的用户生成电影推荐时--你确切地知道有多少用户。所以你定期为每个用户预测一组推荐，比如每隔几个小时。</p> <p>为了使他们的用户输入空间有限，许多应用程序让他们的用户从类别中选择，而不是胡乱输入查询。例如，如果你到大众点评上点餐，你首先要进行定位，或者指定的一个具体位置。这种方法有很多局限性。当然，其结果在其预定义的类别中还不错，如 “航空科技大厦”附近的“餐馆”，但当你试图输入“北京的高评级鲁菜餐馆”这样的无目标的查询时，结果就可能不太理想。</p> <p>批量预测造成的限制甚至存在于像Netflix这样技术上更先进的公司。比如说，你最近看了很多恐怖片，所以当你第一次登录Netflix时，恐怖片在推荐中占主导地位。但你今天感觉很兴奋，所以你搜索了“喜剧”并开始浏览喜剧类别。Netflix应该学习并在你的推荐列表中向你展示更多喜剧，对吗？但它不能更新列表，而是要直到下一次生成批量推荐。</p> <p>在上面的两个例子中，批量预测导致了用户体验的下降（这与用户活跃度/留存紧密相连），而不是灾难性的失败。其他例子还有广告排名、微博的趋势标签排名、滴滴预估匹配时间等。</p> <p>从批量预测转换到实时预测，可以使用动态特征来进行更相关的预测。这里的静态特征指的是变化缓慢或很少变化的信息，如年龄、性别、工作、好友圈等。动态特征是基于现在正在发生的事件的特征，比如你正在浏览什么，你刚刚下单了什么等等。了解用户当前的兴趣，将使你的系统能够做出与他们更相关的推荐。</p> <h3 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案</h3> <p>为了使你的系统能够进行在线预测，它必须有两个组成部分：</p> <ul><li>快速推理：可以在几毫秒内做出预测的模型。</li> <li>实时管道：能够处理数据，将其输入模型，并实时返回预测的管道。</li></ul> <h4 id="快速推理"><a href="#快速推理" class="header-anchor">#</a> 快速推理</h4> <p>当一个模型太大，预测时间太长时，有三种方法：</p> <ol><li>使模型更快（推理优化）</li></ol> <p>例如，融合操作，分布计算，优化内存占用，编写针对特定硬件的高性能内核，等等。</p> <ol start="2"><li>使模型更小（模型压缩）</li></ol> <p>最初，这个系列的技术是使模型更小，以使它们适合边缘设备。使模型变小通常会使它们运行得更快。例如，用16位浮点数（半精度）或8位整数（定点）代替32位浮点数（全精度）来表示你的模型权重。在极端情况下，有些人尝试用1位表示（二进制权重神经网络），例如<a href="https://arxiv.org/abs/1511.00363" target="_blank" rel="noopener noreferrer">BinaryConnect<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和<a href="https://arxiv.org/abs/1603.05279" target="_blank" rel="noopener noreferrer">Xnor-Net<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。Xnor-Net的作者从Xnor.ai分拆出来，这是一家专注于模型压缩的创业公司，<a href="https://www.geekwire.com/2020/exclusive-apple-acquires-xnor-ai-edge-ai-spin-paul-allens-ai2-price-200m-range/" target="_blank" rel="noopener noreferrer">据说被苹果公司以2亿美元收购。<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
不过这种技术通常出现在CV、NLP等领域比较常用。</p> <ol start="3"><li>让硬件更快</li></ol> <p>这是另一个正在蓬勃发展的研究领域。国内外的大厂和初创公司都在竞相开发硬件，使大型ML模型能够在云端，尤其是在设备上更快地进行推理，甚至训练。</p> <h4 id="实时管道"><a href="#实时管道" class="header-anchor">#</a> 实时管道</h4> <h4 id="事件驱动与请求驱动"><a href="#事件驱动与请求驱动" class="header-anchor">#</a> 事件驱动与请求驱动</h4> <p>在过去的十年中，软件世界已经走向了微服务。这个做法是把你的业务逻辑分解成小的组件——每个组件都是一个独立的服务——可以独立维护。每个组件的所有者可以快速更新和测试该组件，而不必访问系统的其他部分。</p> <p>微服务通常与REST结伴出现，REST是一套让这些微服务进行通信的方法。REST APIs是请求驱动的。客户端（服务）通过POST和GET等方法发送请求，告诉它的Server到底要做什么，而它的Server会对结果做出回应。Server必须监听请求，才能进行注册。因为在一个请求驱动的世界里，数据是通过对不同服务的请求来处理的，所以没有人对数据如何在整个系统中流动有一个总体的了解。考虑一个有3个服务的简单系统：</p> <ul><li>A管理司机的供应</li> <li>B管理乘车需求</li> <li>C预测客户每次要求乘车时的最佳价格。</li></ul> <p>因为价格取决于供应和需求，服务C的输出取决于服务A和B的输出。C需要ping A和B进行预测，A需要ping B知道是否调动更多的司机，ping C知道给他们什么价格激励。第二，没有简单的方法来监测A或B的逻辑变化如何影响服务C的性能，或者在服务C的性能突然下降时映射数据流来进行调试。</p> <p>只有3个服务，事情就已经很复杂了。想象一下，如果有成百上千的服务，就像大型互联网公司所拥有的那样。服务间的通信将是高负载的。在HTTP上以JSON blobs的形式发送数据——REST请求通常采用的方式，当然也很慢。服务间的数据传输会成为一个瓶颈，使整个系统变慢。</p> <p>与其让20个服务向服务A索取数据，不如说每当服务A发生事件时，这个事件就会被广播到一个流中，哪个服务想要A的数据，就可以订阅这个流并挑选出它所需要的数据？如果有一个流，所有的服务都可以广播他们的事件并订阅，那会怎么样？这种模式被称为pub/sub：发布和订阅。这就是像Kafka这样的工具的处理方式。由于所有的数据都是通过一个流来流动的，你可以设置一个dashboard来监控你的数据和它在整个系统中的流转。因为它是基于服务所广播的事件，这种架构是事件驱动的。</p> <p>总的来说，请求驱动架构对那些更多依赖逻辑而非数据的系统很有效。事件驱动架构对重数据的系统来说效果更好。</p> <h2 id="level-2-持续学习-你的系统可以接收新数据并实时更新"><a href="#level-2-持续学习-你的系统可以接收新数据并实时更新" class="header-anchor">#</a> level 2：持续学习——你的系统可以接收新数据并实时更新</h2> <p>这里的实时定义为分钟级的。当听到持续学习时，人们想象更新模型非常频繁，比如每5分钟一次。许多人认为大多数公司不需要如此频繁的更新，因为：</p> <ul><li>他们没有流量使该再训练计划有意义。</li> <li>他们的模型不会衰减得那么快。</li></ul> <p>这种说法对也不对，因为持续学习不是关于再训练的频率，而是模型被再训练的方式。</p> <blockquote><p>采用持续学习的好处是，与其根据一个固定的时间表或观察模型的在一段时间内的表现来更新你的模型，不如在数据分布发生变化和模型的性能急剧下降时不断地更新你的模型。</p></blockquote> <h3 id="界定-持续学习"><a href="#界定-持续学习" class="header-anchor">#</a> 界定“持续学习”</h3> <p>这里的“持续学习”，指的是系统可以实时接收用户反馈的数据点或微批量的数据样本进行动态更新模型。在一个数据点上运行学习步骤可能比在一个微批量样本上运行学习步骤更昂贵（高并发的场景可以通过拥有足够强大的硬件来处理一个数据点来缓解）。即使一个模型在每个传入的数据点上学习，也不意味着新的权重在每个数据点后被部署。在我们目前对ML算法如何学习的有限理解下，更新的模型需要首先被评估，看看它的表现如何。</p> <p>对于大多数做所谓的在线训练或在线学习的公司来说，他们的模型都是在数据点累积到一定batch后在进行的学习，并在一定时间后进行评估。只有在其性能被评估为令人满意后，模型才会被更广泛地部署。据了解，在微博的机器学习团队，他们从学习到部署模型更新的迭代周期是10分钟。</p> <p>大多数公司做的是无状态再训练——模型每次都是从头开始训练。而真正的持续学习意味着允许有状态的训练——模型在新数据上继续训练（模型权重微调）。</p> <blockquote><p>一旦你的基础设施被设置为做有状态的训练，训练频率只是一个可以自定义的频次。你可以每小时更新一次模型，每天一次，或者每当你的系统检测到分布变化时，即可以更新你的模型。</p></blockquote> <p><strong>！需要注意的是</strong>，持续学习框架中有状态训练指的是数据迭代。如果您更改模型架构或添加新特征，您仍然需要从头开始训练新模型。</p> <p>有状态的再训练允许你用更少的数据更新你的模型。如果您每月更新一次模型，您可能需要根据过去3个月的数据从头开始重新训练模型。但是，如果您每天都更新您的模型，您只需要根据前一天的数据微调您的模型。对于每个数据点都要更新模型的场景，要求会高很多，您的服务需要更高频率的加载最新模型，同时需要将用户的实时反馈事件与服务加载的模型进行动态连接和训练。持续学习的另一个好特性是您最多只需要查看每个数据样本两次：一次在预测期间，一次在模型训练期间。如果您担心数据隐私，您可以在使用数据样本后丢弃它们。</p> <div align="center"><img src="/stratefull_train.png" width="85%"></div> <center>无状态与有状态训练</center> <h3 id="应用案例-2"><a href="#应用案例-2" class="header-anchor">#</a> 应用案例</h3> <p>我们熟知的TikTok是很容易成瘾的app。它的秘密在于它的推荐系统能够快速学习你的偏好，并推荐你接下来可能会观看的视频，给用户带来难以置信的滚动体验，当然这在持续学习的系统面前这是可行的，因为TikTok背后的公司ByteDance已经建立了一个成熟的基础设施，使他们的推荐系统能够实时学习用户的喜好（用他们的行话说是“用户标签”）。</p> <p>推荐系统是持续学习的完美场景。它们有自然的标签——如果一个用户点击了一个推荐，那就是一个正确的预测。当然并非所有的推荐系统都需要持续的学习， 比如用户对房屋、汽车、航班、酒店等物品的偏好不太可能从一分钟到下一分钟发生变化，所以系统持续学习的意义不大。然而，用户对在线内容——视频、文章、新闻、推特、帖子、备忘录的偏好可能变化非常快。由于对在线内容的偏好是实时变化的，广告系统也需要实时更新以显示相关的广告。</p> <p>持续的学习对于系统适应突发事件至关重要。考虑一下”双十一“网上购物。因为”双十一“每年只发生一次，某宝或其他电子商务网站不可能获得足够的历史数据来了解用户在那一天的行为，所以他们的系统需要在那一天不断地学习以适应。</p> <p>持续学习在需要边缘部署的场景也非常有效，当你把持续学习和边缘部署结合起来的时候。想象一下，你可以将一个基础模型与一个新的设备——手机、手表、无人机等一起发布，该设备上的模型将不断地更新并适应其环境。没有集中的服务器成本，不需要在设备和云之间来回传输数据。</p> <p>此外，持续的学习也可以帮助解决冷启动问题。一个用户刚刚加入你的应用程序，你还没有他们的信息。如果你没有任何形式的持续学习的能力，你将不得不为你的用户提供一般的推荐，直到下一次你的模型启动离线训练时。</p> <blockquote><p>Grubhub 在从无状态每日再训练切换到有状态每日再训练后，将训练成本降低了<a href="https://arxiv.org/abs/2107.07106" target="_blank" rel="noopener noreferrer">45倍<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（2021 年）。</p></blockquote> <h3 id="解决方案-2"><a href="#解决方案-2" class="header-anchor">#</a> 解决方案</h3> <p>由于持续学习仍然相当新，而且大多数正在做的公司还没有公开开源或讨论它的细节，所以没有标准的解决方案。</p> <p>持续学习并不意味着“没有批量训练”。那些最成功地使用持续学习的公司也在离线情况下并行训练他们的模型，然后将在线版本与离线版本结合起来。</p> <h3 id="挑战"><a href="#挑战" class="header-anchor">#</a> 挑战</h3> <p>持续学习面临许多挑战，包括理论和实践。</p> <h4 id="理论方面"><a href="#理论方面" class="header-anchor">#</a> 理论方面</h4> <p>持续学习把我们所学到的很多关于机器学习的知识都颠覆了。在机器学习的入门课上，学生们可能会被教导不同版本的“用足够数量的历时来训练你的模型直到收敛”。在持续学习中，没有epoch——你的模型对每个数据点只看一次。也没有所谓的收敛。你的基础数据分布一直在变化。没有什么固定的东西可以收敛。</p> <p>持续学习的另一个理论挑战是模型评估。在传统的批量训练中，你在固定的测试集上评估你的模型。如果一个新的模型在相同的测试集上比现有的模型表现得更好，我们就说新的模型更好。然而，持续学习的目标是让你的模型适应不断变化的数据。如果你更新的模型是为了适应现在的数据而训练的，而我们知道现在的数据与过去的数据不同，那么用旧的数据来测试你更新的模型就没有意义了。</p> <p>那么我们怎么知道根据过去10分钟的数据训练的模型比根据20分钟前的数据训练的模型更好呢？我们必须在当前数据上比较这两个模型。在线训练需要在线评估，但把一个没有经过测试的模型提供给用户，听起来是一件挺有风险的事。</p> <p>许多公司还是这样做了。新的模型首先要接受离线测试，以确保它们不是灾难性的，然后通过一个复杂的A/B测试系统与现有的模型同时进行在线评估。只有当一个模型被证明在公司关心的某些指标上优于现有模型时，它才能被更广泛地部署。(不要让一开始就为在线评估选择一个指标）。</p> <h4 id="实践"><a href="#实践" class="header-anchor">#</a> 实践</h4> <p>目前还没有在线训练的标准基础设施。一些公司已经趋向于使用参数服务器的流媒体架构，但除此之外，我所接触过的做在线训练的公司都必须在内部建立大量的基础设施。</p> <p>此外，在这个阶段你需要的主要是一个更好的模型存储。</p> <ul><li>模型血统：你不仅要对你的模型进行版本管理，还要跟踪它们的脉络——哪个模型对哪些参数进行微调。</li> <li>流特征的可重现性：你希望能够通过时间戳来提取过去的流特征，并在过去的任何时候为你的模型重新创建训练数据，以防发生什么事情，你需要进行调试。</li></ul> <p>据我所知，没有一个现成的模型存储具有这两种能力。你也许可以将流式特征的可重现性委托给一个特征存储库（feature store），但你很可能必须在内部建立这个解决方案。</p> <blockquote><p><strong>tips</strong>：记录和等待（特征重用）
当你在新的数据上重新训练你的模型时，很可能新的数据已经经过了你的预测服务，这意味着已经为预测提取了一次特征。很多公司将这些提取的特征重新用于模型更新，这既节省了计算量，又能使预测和训练之间保持一致。这种方法被称为记录和等待。这是一个经典的方法，可以减少训练服务的偏差（由生产环境和开发环境不匹配造成的错误）。
这还不是一个流行的方法，但它正变得越来越流行。我预计它很快就会成为一种标准。<a href="https://craft.faire.com/building-faires-new-marketplace-ranking-infrastructure-a53bf938aba0" target="_blank" rel="noopener noreferrer">Faire有一篇很好的博文<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，讨论了他们的日志和等待方法的优点和缺点。</p></blockquote> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>无论你是否准备好，机器学习的发展趋势都是在向实时前进。虽然大多数公司还在争论在线推理和持续学习是否有价值，但一些做得正确的公司已经看到了投资回报，他们的实时算法可能是帮助他们领先于竞争对手的一个主要因素。</p> <p>实时ML在很大程度上是一个基础设施问题。要解决这个问题，需要数据科学/ML团队和平台团队共同合作。在线推理和持续学习都需要一个成熟的基础设施。持续学习的训练部分可以在批处理中完成，但在线评估部分需要流数据。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-ac050c62><li class="level-2" data-v-ac050c62><a href="/blogs/online_learning/2022/090401.html#概述" class="sidebar-link reco-side-概述" data-v-ac050c62>概述</a></li><li class="level-2" data-v-ac050c62><a href="/blogs/online_learning/2022/090401.html#level-1-在线预测-你的系统可以实时进行预测" class="sidebar-link reco-side-level-1-在线预测-你的系统可以实时进行预测" data-v-ac050c62>level 1：在线预测——你的系统可以实时进行预测</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/online_learning/2022/090401.html#应用案例" class="sidebar-link reco-side-应用案例" data-v-ac050c62>应用案例</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/online_learning/2022/090401.html#解决方案" class="sidebar-link reco-side-解决方案" data-v-ac050c62>解决方案</a></li><li class="level-2" data-v-ac050c62><a href="/blogs/online_learning/2022/090401.html#level-2-持续学习-你的系统可以接收新数据并实时更新" class="sidebar-link reco-side-level-2-持续学习-你的系统可以接收新数据并实时更新" data-v-ac050c62>level 2：持续学习——你的系统可以接收新数据并实时更新</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/online_learning/2022/090401.html#界定-持续学习" class="sidebar-link reco-side-界定-持续学习" data-v-ac050c62>界定“持续学习”</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/online_learning/2022/090401.html#应用案例-2" class="sidebar-link reco-side-应用案例-2" data-v-ac050c62>应用案例</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/online_learning/2022/090401.html#解决方案-2" class="sidebar-link reco-side-解决方案-2" data-v-ac050c62>解决方案</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/online_learning/2022/090401.html#挑战" class="sidebar-link reco-side-挑战" data-v-ac050c62>挑战</a></li><li class="level-2" data-v-ac050c62><a href="/blogs/online_learning/2022/090401.html#总结" class="sidebar-link reco-side-总结" data-v-ac050c62>总结</a></li></ul></main></div> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.e0cdc796.js" defer></script><script src="/assets/js/3.c71f12a5.js" defer></script><script src="/assets/js/1.83d3f97c.js" defer></script><script src="/assets/js/13.726d257e.js" defer></script>
  </body>
</html>
